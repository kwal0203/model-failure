---
import { render } from "astro:content";
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";
import { getPublications } from "@/data/modelfailure";
import PageLayout from "@/layouts/Base.astro";

export const getStaticPaths = (async () => {
	const entries = await getPublications();
	return entries.map((entry) => ({
		params: { slug: entry.id },
		props: { entry },
	}));
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { entry } = Astro.props;
const { Content } = await render(entry);
const links = Object.entries(entry.data.links).filter(
	(link): link is [string, string] => typeof link[1] === "string" && link[1].length > 0,
);
---

<PageLayout
	meta={{
		description: `${entry.data.venue} (${entry.data.year})`,
		title: entry.data.title,
	}}
>
	<article class="prose prose-sm max-w-none">
		<h1 class="title mb-3">{entry.data.title}</h1>
		<p class="not-prose mb-1 text-sm">{entry.data.authors.join(", ")}</p>
		<p class="not-prose mb-1 text-sm">
			{entry.data.venue} ({entry.data.year}) - {entry.data.type}
		</p>
		<p class="not-prose mb-6 text-sm">Featured: {entry.data.featured ? "Yes" : "No"}</p>
		{entry.data.topics.length > 0 && (
			<ul class="not-prose mb-6 flex flex-wrap gap-2" role="list">
				{entry.data.topics.map((topic) => (
					<li class="cactus-link text-sm">#{topic}</li>
				))}
			</ul>
		)}
		{links.length > 0 && (
			<ul class="not-prose mb-8 flex flex-wrap gap-3 text-sm" role="list">
				{links.map(([key, value]) => (
					<li>
						<a class="cactus-link" href={value}>
							{key}
						</a>
					</li>
				))}
			</ul>
		)}
		<Content />
	</article>
</PageLayout>
